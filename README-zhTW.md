# Paytocol (paytocol.xyz)

## çŽå‹µè´ŠåŠ©
- Circleï¼ŒåŸºæ–¼ CCTP2.0 è®“ç”¨æˆ¶å¯ä»¥åœ¨ä»»æ„éˆå°‡è³‡é‡‘æé ˜å‡ºä¾†æˆ–æ˜¯å­˜å…¥åˆç´„ä¾†è´ŠåŠ©
- å­˜å…¥ç‰¹å®šæ± å­ä¾†ç”Ÿåˆ©æ¯
- ~~1inchï¼Œç”¨æˆ¶å¯ä»¥é¸æ“‡ç”¨ä»€éº¼ä»£å¹£ä¾†æ”¯ä»˜ï¼Œæœƒå…ˆè½‰ç‚º USDC / æ›ç‚ºå¯ç”Ÿæ¯çš„åˆ©çŽ‡~~
- ~~World Mini App~~
- ~~1inch funsion+ æ˜¯å¦èƒ½å¤ ç™¼ postMessage~~

## ä¸»é¡Œæƒ…å¢ƒ

### ðŸŒŠ æ„åœ–ç¶²è·¯æ¨¡å¼ (current)

#### ä½¿ç”¨è€…é€²è¡Œè´ŠåŠ©
ç•¶ä½¿ç”¨è€…å‰µå»ºä¸€å€‹æ”¯ä»˜è«‹æ±‚æ™‚ï¼Œè³‡è¨Šå°‡æ ¹æ“šã€Œä½¿ç”¨ dApp æ”¯ä»˜ã€çš„æ–¹å¼å°‡ä»£å¹£åˆ©ç”¨
æœ‰ä¸‰å€‹è§’è‰²åœ¨é€™å€‹äº¤æ˜“éŽç¨‹ä¸­
- ä½¿ç”¨è€…ï¼Œæƒ³è¦ç™¼èµ·äº¤æ˜“çš„ç”¨æˆ¶
- Paytocol åˆç´„ï¼Œè² è²¬èˆ‡ CCTP é€²è¡Œè·¨éˆæºé€š; å­˜æ¬¾æ‰˜ç®¡
- Solverï¼Œå”åŠ©åœ¨è·¨éˆå¾Œé€²è¡Œå­˜å…¥ Morpho æ“ä½œ
æµç¨‹å¦‚ä¸‹:
1. ä½¿ç”¨è€…è·Ÿ dApp äº’å‹•ç™¼èµ·äº¤æ˜“ï¼ŒåŒ…å«æ”¶æ¬¾äººåœ°å€ã€é‡‘é¡ã€ä»£å¹£åœ°å€ã€é€±æœŸå°‡ä»£å¹£å­˜å…¥åˆç´„
2. å°‡ç©©å®šå¹£ï¼Œæ”¶æ¬¾äººåœ°å€ï¼Œè´ŠåŠ©é€±æœŸç­‰è³‡è¨Šå¯«å…¥ backend èˆ‡åˆç´„äº’å‹•
3. å°‡ç©©å®šå¹£åˆ©ç”¨ CCTP è·¨éˆåˆ° Base çš„ Paytocol åˆç´„
4. Solver å¹«å¿™å¾žåˆç´„å­˜é€²æœƒç”Ÿæ¯è³‡ç”¢çš„ Morpho å”è­° å†å°‡è³‡ç”¢è½‰å›ž Paytocol åˆç´„

#### Guardian (only show in system diagram)
ç”¨ä¾†é©—è­‰éˆä¸Šäº¤æ˜“æ˜¯å¦å®Œæˆï¼Œèƒ½å°ä¸€å€‹è¨‚å–®é€²è¡Œç‹€æ…‹çš„æ”¹è®Šï¼Œä¾‹å¦‚ é©—è­‰ close æˆ–æ˜¯æŒ‘æˆ° openã€‚

#### Paytocol Solver
ç•¶æœ‰ä¸€ç­†è´ŠåŠ©çš„è¨‚å–®å‡ºç¾æ™‚ï¼ŒSolver å¯ä»¥è·Ÿ backend/åˆç´„ å–å¾—è¨‚å–®è³‡è¨Šï¼Œä¸¦ä¸”é€²ä¸€æ­¥åŽ»æ ¹æ“šæŠµæŠ¼å­˜æ¬¾ä¾†å–å¾—è¨‚å–®çš„çµç®—æ¬Šã€‚
- æ ¹æ“š blocktime ä¾†æ±ºå®šæ™‚é–“å®Œæˆèˆ‡å¦ã€‚
- è² è²¬è™•ç†ç”Ÿæ¯è·¨éˆå¾Œçš„è¡Œç‚ºèˆ‡æé ˜çµ¦ç”¨æˆ¶
- ä»–å¯ä»¥æ˜¯ä¸€å€‹ cross chain streaming protocol çš„ç”Ÿæ…‹ã€‚

#### è¢«è´ŠåŠ©è€…æé ˜è³‡é‡‘
æœ‰ä¸‰å€‹è§’è‰²åœ¨é€™å€‹äº¤æ˜“éŽç¨‹ä¸­
- æ”¶æ¬¾æ–¹ï¼Œæƒ³è¦æ”¶æ¬¾çš„ç”¨æˆ¶
- Base Paytocol åˆç´„ï¼Œè² è²¬å­˜æ¬¾æ‰˜ç®¡
- Solverï¼Œå”åŠ©æ”¶æ¬¾æ–¹å°‡è³‡ç”¢å¾ž Morpho æé ˜å‡ºä¾†

Solver éœ€è¦æ ¹æ“š blocktime åœ¨æ­£è²  1 å°æ™‚å…§å°‡è¨‚å–®å®Œæˆï¼Œæ”¶æ¬¾æ–¹å¯ä»¥åœ¨å¾Œå°è¨­å®šæé ˜æ™‚é¸æ“‡åœ¨é‚£å€‹éˆèˆ‡éŒ¢åŒ…æ”¶æ¬¾

1. Solver å° Base Paytocol åˆç´„ç™¼èµ·äº¤æ˜“
2. Base Paytocol æœƒæŠŠç”Ÿæ¯è³‡ç”¢å¾ž Morpho æ›å›ž USDC ç„¶å¾Œè½‰é€²æ”¶æ¬¾æ–¹


### ç³»çµ±è¨­è¨ˆ

#### ç™¼èµ·ä¸€ç­†è½‰å¸³

```
sequenceDiagram
    participant User
    participant dApp
    participant Backend
    participant Paytocol Contract
    participant CCTP
    participant Solver
    participant Base Paytocol Contract
    participant Morpho Protocol

    User->>dApp: ç™¼èµ·äº¤æ˜“ (æ”¶æ¬¾äººåœ°å€, é‡‘é¡, ä»£å¹£åœ°å€, é€±æœŸ)
    dApp->>Paytocol Contract: å¯«å…¥éˆä¸Šè³‡è¨Šï¼Œå­˜å…¥ä»£å¹£
    dApp->>Backend: ç™¼é€äº¤æ˜“è³‡è¨Š (ç©©å®šå¹£, æ”¶æ¬¾äººåœ°å€, è´ŠåŠ©é€±æœŸ)
    Paytocol Contract->>CCTP: ç™¼èµ·è·¨éˆè«‹æ±‚ (ç©©å®šå¹£)
    CCTP-->>Base Paytocol Contract: è·¨éˆæˆåŠŸ (ç©©å®šå¹£)
    Base Paytocol Contract-->>Solver: è§¸ç™¼å®ŒæˆåŸ·è¡Œäº‹ä»¶
    Solver->>Base Paytocol Contract: æŸ¥è©¢è¨‚å–®è³‡è¨Š
    Base Paytocol Contract-->>Solver: è¿”å›žè¨‚å–®è³‡è¨Š
    Solver->>Base Paytocol Contract: å¾žåˆç´„æå–ç©©å®šå¹£
    Base Paytocol Contract->>Morpho Protocol: å­˜å…¥ç©©å®šå¹£ä»¥è³ºå–åˆ©æ¯
    %% Morpho Protocol-->>Base Paytocol Contract: å­˜æ¬¾æˆåŠŸ
    %% Base Paytocol Contract-->>Morpho Protocol: æå–æˆåŠŸ (ç”Ÿæ¯è³‡ç”¢)
    %% Base Paytocol Contract->>Base Paytocol Contract: å­˜å›ž Paytocol åˆç´„
    %% Base Paytocol Contract->>Morpho Protocol: å¾ž Morpho æå–ç”Ÿæ¯è³‡ç”¢
```

```
sequenceDiagram
    participant User
    participant dApp
    participant Backend
    participant Paytocol Contract
    participant CCTP
    participant Solver
    participant Base Paytocol Contract
    participant Morpho Protocol

    User->>dApp: Initiate Transaction (Recipient Address, Amount, Token Address, Period)
    dApp->>Paytocol Contract: Write On-chain Information, Deposit Tokens
    dApp->>Backend: Send Transaction Information (Stablecoin, Recipient Address, Sponsorship Period)
    Paytocol Contract->>CCTP: Initiate Cross-chain Request (Stablecoin)
    CCTP-->>Base Paytocol Contract: Cross-chain Successful (Stablecoin)
    Base Paytocol Contract-->>Solver: Trigger Completion Event
    Solver->>Base Paytocol Contract: Query Order Information
    Base Paytocol Contract-->>Solver: Return Order Information
    Solver->>Base Paytocol Contract: Withdraw Stablecoin from Contract
    Base Paytocol Contract->>Morpho Protocol: Deposit Stablecoin to Earn Interest
    %% Morpho Protocol-->>Base Paytocol Contract: Deposit Successful
    %% Base Paytocol Contract-->>Morpho Protocol: Withdrawal Successful (Interest-Bearing Assets)
    %% Base Paytocol Contract->>Base Paytocol Contract: Deposit Back to Paytocol Contract
    %% Base Paytocol Contract->>Morpho Protocol: Withdraw Interest-Bearing Assets from Morpho
```

#### è¢«è´ŠåŠ©è€…æé ˜è³‡é‡‘

```
sequenceDiagram
    participant Solver
    participant Base Paytocol Contract
    participant Morpho Protocol
    participant Recipient

    Solver->>Base Paytocol Contract: ç™¼èµ·æé ˜äº¤æ˜“
    Base Paytocol Contract->>Morpho Protocol: å¾ž Morpho æ›å›ž USDC (ç”Ÿæ¯è³‡ç”¢)
    Morpho Protocol-->>Base Paytocol Contract: USDC å…Œæ›å®Œæˆ
    Base Paytocol Contract->>Recipient: å°‡ USDC è½‰çµ¦æ”¶æ¬¾æ–¹
```

```
sequenceDiagram
    participant Solver
    participant Base Paytocol Contract
    participant Morpho Protocol
    participant Recipient

    Solver->>Base Paytocol Contract: Initiate Withdrawal Transaction
    Base Paytocol Contract->>Morpho Protocol: Swap Interest-Bearing Assets back to USDC
    Morpho Protocol-->>Base Paytocol Contract: USDC Swap Completed
    Base Paytocol Contract->>Recipient: Transfer USDC to Recipient
```
